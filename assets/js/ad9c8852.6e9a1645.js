(self.webpackChunkkubevela_io=self.webpackChunkkubevela_io||[]).push([[800],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return m},kt:function(){return d}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),u=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},m=function(e){var t=u(e.components);return a.createElement(p.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,m=i(e,["components","mdxType","originalType","parentName"]),c=u(n),d=r,k=c["".concat(p,".").concat(d)]||c[d]||s[d]||o;return n?a.createElement(k,l(l({ref:t},m),{},{components:n})):a.createElement(k,l({ref:t},m))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=c;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:r,l[1]=i;for(var u=2;u<o;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},23786:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},metadata:function(){return i},toc:function(){return p},default:function(){return m}});var a=n(22122),r=n(19756),o=(n(67294),n(3905)),l={title:"Kustomize"},i={unversionedId:"end-user/components/kustomize",id:"end-user/components/kustomize",isDocsHomePage:!1,title:"Kustomize",description:"Create a Kustomize Component, it could be from Git Repo or OSS bucket.",source:"@site/docs/end-user/components/kustomize.md",sourceDirName:"end-user/components",slug:"/end-user/components/kustomize",permalink:"/docs/next/end-user/components/kustomize",editUrl:"https://github.com/oam-dev/kubevela.io/edit/main/docs/end-user/components/kustomize.md",version:"current",lastUpdatedBy:"Lei Zhang (Harry)",lastUpdatedAt:1633157757,formattedLastUpdatedAt:"10/2/2021",frontMatter:{title:"Kustomize"},sidebar:"docs",previous:{title:"Helm",permalink:"/docs/next/end-user/components/helm"},next:{title:"Alibaba Cloud ACK",permalink:"/docs/next/end-user/components/cloud-services/terraform/alibaba-ack"}},p=[{value:"Deploy From OSS bucket",id:"deploy-from-oss-bucket",children:[{value:"Attributes",id:"attributes",children:[]}]},{value:"Deploy From Git Repo",id:"deploy-from-git-repo",children:[]}],u={toc:p};function m(e){var t=e.components,n=(0,r.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Create a Kustomize Component, it could be from Git Repo or OSS bucket."),(0,o.kt)("h2",{id:"deploy-from-oss-bucket"},"Deploy From OSS bucket"),(0,o.kt)("p",null,"KubeVela's ",(0,o.kt)("inlineCode",{parentName:"p"},"kustomize")," component meets the needs of users to directly connect Yaml files and folders as component products. No matter whether your Yaml file/folder is stored in a Git Repo or an OSS bucket, KubeVela can read and deliver it."),(0,o.kt)("p",null,"Let's take the YAML folder component from the OSS bucket registry as an example to explain the usage. In the ",(0,o.kt)("inlineCode",{parentName:"p"},"Application")," this time, I hope to deliver a component named bucket-comp. The deployment file corresponding to the component is stored in the cloud storage OSS bucket, and the corresponding bucket name is definition-registry. ",(0,o.kt)("inlineCode",{parentName:"p"},"kustomize.yaml")," comes from this address of oss-cn-beijing.aliyuncs.com and the path is ",(0,o.kt)("inlineCode",{parentName:"p"},"./app/prod/"),"."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"(Optional) If your OSS bucket needs identity verification, create a Secret:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"$ kubectl create secret generic bucket-secret --from-literal=accesskey=<your-ak> --from-literal=secretkey=<your-sk>\nsecret/bucket-secret created\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Deploy it:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cat <<EOF | kubectl apply -f -\napiVersion: core.oam.dev/v1beta1\nkind: Application\nmetadata:\n  name: bucket-app\nspec:\n  components:\n    - name: bucket-comp\n      type: kustomize\n      properties:\n        repoType: oss\n        # If the bucket is private, you will need to provide\n        secretRef: bucket-secret\n        url: oss-cn-beijing.aliyuncs.com\n        oss:\n          bucketName: definition-registry\n        path: ./app/prod/\nEOF\n")),(0,o.kt)("p",null,"Please copy the above code block and deploy it directly to the runtime cluster:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"application.core.oam.dev/bucket-app created\n")),(0,o.kt)("p",null,"Finally, we use ",(0,o.kt)("inlineCode",{parentName:"p"},"vela ls")," to view the application status after successful delivery:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"vela ls\nAPP                     COMPONENT   TYPE        TRAITS  PHASE   HEALTHY STATUS  CREATED-TIME                 \nbucket-app              bucket-comp kustomize           running healthy         2021-08-28 18:53:14 +0800 CST\n")),(0,o.kt)("p",null,"The PHASE of the app is running, and the STATUS is healthy. Successful application deployment!"),(0,o.kt)("h3",{id:"attributes"},"Attributes"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"),(0,o.kt)("th",{parentName:"tr",align:null},"Example"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"repoType"),(0,o.kt)("td",{parentName:"tr",align:null},"required, The value of the Git. To indicate that kustomize configuration comes from the Git repository"),(0,o.kt)("td",{parentName:"tr",align:null},"oss")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"pullInterval"),(0,o.kt)("td",{parentName:"tr",align:null},"optional, Synchronize with Git repository, and the time interval between tuning helm release. The default value is 5m (5 minutes\uff09"),(0,o.kt)("td",{parentName:"tr",align:null},"10m")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"url"),(0,o.kt)("td",{parentName:"tr",align:null},"required, bucket's endpoint, no need to fill in with scheme"),(0,o.kt)("td",{parentName:"tr",align:null},"oss-cn-beijing.aliyuncs.com")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"secretRef"),(0,o.kt)("td",{parentName:"tr",align:null},"optional, Save the name of a Secret, which is the credential to read the bucket. Secret contains accesskey and secretkey fields"),(0,o.kt)("td",{parentName:"tr",align:null},"sec-name")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"timeout"),(0,o.kt)("td",{parentName:"tr",align:null},"optional, The timeout period of the download operation, the default is 20s"),(0,o.kt)("td",{parentName:"tr",align:null},"60s")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"path"),(0,o.kt)("td",{parentName:"tr",align:null},"required, The directory containing the kustomization.yaml file, or the directory containing a set of YAML files (used to generate kustomization.yaml)"),(0,o.kt)("td",{parentName:"tr",align:null},"./prod")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"oss.bucketName"),(0,o.kt)("td",{parentName:"tr",align:null},"required, bucket name"),(0,o.kt)("td",{parentName:"tr",align:null},"your-bucket")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"oss.provider"),(0,o.kt)("td",{parentName:"tr",align:null},"optional, Generic or aws, if you get the certificate from aws EC2, fill in aws. The default is generic."),(0,o.kt)("td",{parentName:"tr",align:null},"generic")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"oss.region"),(0,o.kt)("td",{parentName:"tr",align:null},"optional, bucket region"),(0,o.kt)("td",{parentName:"tr",align:null})))),(0,o.kt)("h2",{id:"deploy-from-git-repo"},"Deploy From Git Repo"),(0,o.kt)("table",null,(0,o.kt)("thead",{parentName:"table"},(0,o.kt)("tr",{parentName:"thead"},(0,o.kt)("th",{parentName:"tr",align:null},"Parameters"),(0,o.kt)("th",{parentName:"tr",align:null},"Description"),(0,o.kt)("th",{parentName:"tr",align:null},"Example"))),(0,o.kt)("tbody",{parentName:"table"},(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"repoType"),(0,o.kt)("td",{parentName:"tr",align:null},"required, The value of the Git. To indicate that kustomize configuration comes from the Git repository"),(0,o.kt)("td",{parentName:"tr",align:null},"git")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"pullInterval"),(0,o.kt)("td",{parentName:"tr",align:null},"optional, Synchronize with Git repository, and the time interval between tuning helm release. The default value is 5m (5 minutes\uff09"),(0,o.kt)("td",{parentName:"tr",align:null},"10m")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"url"),(0,o.kt)("td",{parentName:"tr",align:null},"required, Git repository address"),(0,o.kt)("td",{parentName:"tr",align:null},(0,o.kt)("a",{parentName:"td",href:"https://github.com/oam-dev/terraform-controller"},"https://github.com/oam-dev/terraform-controller"))),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"secretRef"),(0,o.kt)("td",{parentName:"tr",align:null},"optional, The Secret object name that holds the credentials required to pull the Git repository. The username and password fields must be included in the HTTP/S basic authentication Secret. For SSH authentication, the identity, identity.pub and known_hosts fields must be included"),(0,o.kt)("td",{parentName:"tr",align:null},"sec-name")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"timeout"),(0,o.kt)("td",{parentName:"tr",align:null},"optional, The timeout period of the download operation, the default is 20s"),(0,o.kt)("td",{parentName:"tr",align:null},"60s")),(0,o.kt)("tr",{parentName:"tbody"},(0,o.kt)("td",{parentName:"tr",align:null},"git.branch"),(0,o.kt)("td",{parentName:"tr",align:null},"optional, Git branch, master by default"),(0,o.kt)("td",{parentName:"tr",align:null},"dev")))),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"How-to")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: core.oam.dev/v1beta1\nkind: Application\nmetadata:\n  name: git-app\nspec:\n  components:\n    - name: git-comp\n      type: kustomize\n      properties:\n        repoType: git\n        url: https://github.com/<path>/<to>/<repo>\n        git:\n          branch: master\n        path: ./app/dev/\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Override Kustomize")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: core.oam.dev/v1beta1\nkind: Application\nmetadata:\n  name: bucket-app\nspec:\n  components:\n    - name: bucket-comp\n      type: kustomize\n      properties:\n        # ...omitted for brevity\n        path: ./app/\n     \n")))}m.isMDXComponent=!0}}]);