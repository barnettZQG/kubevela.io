(self.webpackChunkkubevela_io=self.webpackChunkkubevela_io||[]).push([[93432],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return p},kt:function(){return d}});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function c(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),s=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=s(e.components);return r.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},m=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),m=s(t),d=a,f=m["".concat(l,".").concat(d)]||m[d]||u[d]||o;return t?r.createElement(f,i(i({ref:n},p),{},{components:t})):r.createElement(f,i({ref:n},p))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=m;var c={};for(var l in n)hasOwnProperty.call(n,l)&&(c[l]=n[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,i[1]=c;for(var s=2;s<o;s++)i[s]=t[s];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},30418:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return i},metadata:function(){return c},toc:function(){return l},default:function(){return p}});var r=t(22122),a=t(19756),o=(t(67294),t(3905)),i={title:"Terraform \u7ec4\u4ef6"},c={unversionedId:"platform-engineers/components/component-terraform",id:"version-v1.1/platform-engineers/components/component-terraform",isDocsHomePage:!1,title:"Terraform \u7ec4\u4ef6",description:"\u5bf9\u4e91\u8d44\u6e90\u7684\u96c6\u6210\u9700\u6c42\u5f80\u5f80\u662f\u6700\u9891\u7e41\u51fa\u73b0\uff0c\u6bd4\u5982\u4f60\u53ef\u80fd\u5e0c\u671b\u6570\u636e\u5e93\u3001\u4e2d\u95f4\u4ef6\u7b49\u670d\u52a1\u4f7f\u7528\u963f\u91cc\u4e91\u3001AWS \u7b49\u4e91\u5382\u5546\u7684\uff0c\u4ee5\u83b7\u5f97\u751f\u4ea7\u7ea7\u522b\u7684\u53ef\u7528\u6027\u5e76\u514d\u53bb\u8fd0\u7ef4\u7684\u9ebb\u70e6\u3002Terraform \u662f\u76ee\u524d\u4e1a\u5185\u652f\u6301\u4e91\u8d44\u6e90\u6700\u5e7f\u6cdb\u4e5f\u6700\u53d7\u6b22\u8fce\u7684\u7ec4\u4ef6\uff0cKubeVela \u5bf9 Terraform \u8fdb\u884c\u4e86\u989d\u5916\u7684\u652f\u6301\uff0c\u4f7f\u5f97\u7528\u6237\u53ef\u4ee5\u901a\u8fc7 Kubernetes CRD \u7684\u65b9\u5f0f\u914d\u5408 Terraform \u4f7f\u7528\u4efb\u610f\u7684\u4e91\u8d44\u6e90\u3002",source:"@site/i18n/zh/docusaurus-plugin-content-docs/version-v1.1/platform-engineers/components/component-terraform.md",sourceDirName:"platform-engineers/components",slug:"/platform-engineers/components/component-terraform",permalink:"/zh/docs/platform-engineers/components/component-terraform",editUrl:"https://github.com/oam-dev/kubevela/edit/master/docs/zh/platform-engineers/components/component-terraform.md",version:"v1.1",lastUpdatedBy:"yangsoon",lastUpdatedAt:1629468747,formattedLastUpdatedAt:"2021/8/20",frontMatter:{title:"Terraform \u7ec4\u4ef6"},sidebar:"version-v1.1/docs",previous:{title:"\u81ea\u5b9a\u4e49\u7ec4\u4ef6\u5165\u95e8",permalink:"/zh/docs/platform-engineers/components/custom-component"},next:{title:"\u81ea\u5b9a\u4e49\u8fd0\u7ef4\u7279\u5f81",permalink:"/zh/docs/platform-engineers/traits/customize-trait"}},l=[{value:"\u5f00\u542f Terraform \u63a7\u5236\u5668",id:"\u5f00\u542f-terraform-\u63a7\u5236\u5668",children:[]},{value:"\u914d\u7f6e\u963f\u91cc\u4e91\u9274\u6743",id:"\u914d\u7f6e\u963f\u91cc\u4e91\u9274\u6743",children:[]},{value:"\u4e91\u8d44\u6e90\u5173\u8054 Provider",id:"\u4e91\u8d44\u6e90\u5173\u8054-provider",children:[]},{value:"\u81ea\u5b9a\u4e49 OSS \u4e91\u8d44\u6e90\u7ec4\u4ef6",id:"\u81ea\u5b9a\u4e49-oss-\u4e91\u8d44\u6e90\u7ec4\u4ef6",children:[]}],s={toc:l};function p(e){var n=e.components,t=(0,a.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,r.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u5bf9\u4e91\u8d44\u6e90\u7684\u96c6\u6210\u9700\u6c42\u5f80\u5f80\u662f\u6700\u9891\u7e41\u51fa\u73b0\uff0c\u6bd4\u5982\u4f60\u53ef\u80fd\u5e0c\u671b\u6570\u636e\u5e93\u3001\u4e2d\u95f4\u4ef6\u7b49\u670d\u52a1\u4f7f\u7528\u963f\u91cc\u4e91\u3001AWS \u7b49\u4e91\u5382\u5546\u7684\uff0c\u4ee5\u83b7\u5f97\u751f\u4ea7\u7ea7\u522b\u7684\u53ef\u7528\u6027\u5e76\u514d\u53bb\u8fd0\u7ef4\u7684\u9ebb\u70e6\u3002Terraform \u662f\u76ee\u524d\u4e1a\u5185\u652f\u6301\u4e91\u8d44\u6e90\u6700\u5e7f\u6cdb\u4e5f\u6700\u53d7\u6b22\u8fce\u7684\u7ec4\u4ef6\uff0cKubeVela \u5bf9 Terraform \u8fdb\u884c\u4e86\u989d\u5916\u7684\u652f\u6301\uff0c\u4f7f\u5f97\u7528\u6237\u53ef\u4ee5\u901a\u8fc7 Kubernetes CRD \u7684\u65b9\u5f0f\u914d\u5408 Terraform \u4f7f\u7528\u4efb\u610f\u7684\u4e91\u8d44\u6e90\u3002"),(0,o.kt)("p",null,"\u672c\u7ae0\u8282\uff0c\u5c06\u4e13\u95e8\u4e3a\u4f60\u4ecb\u7ecd\u5982\u4f55\u901a\u8fc7 KubeVela \u4ee5\u53ca Terraform \u6765\u5b9e\u73b0\u81ea\u5b9a\u4e49\u7684\u4e91\u8d44\u6e90\u7ec4\u4ef6\u3002\u6211\u4eec\u4ee5\u963f\u91cc\u4e91\u7684\u5bf9\u8c61\u5b58\u50a8(OSS)\uff0c\u4f5c\u4e3a\u4f8b\u5b50\u6765\u8fdb\u884c\u8bb2\u89e3\u3002"),(0,o.kt)("p",null,"\u5b83\u7684\u5927\u81f4\u6d41\u7a0b\u5982\u4e0b\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u719f\u6089\u5404\u4e91\u670d\u52a1\u5546\u7684\u9274\u6743\u673a\u5236\uff0c\u51c6\u5907\u76f8\u5173\u7684 ",(0,o.kt)("inlineCode",{parentName:"li"},"secret")," \u548c ",(0,o.kt)("inlineCode",{parentName:"li"},"token")," \u7b49\u5fc5\u8981\u4fe1\u606f\u3002"),(0,o.kt)("li",{parentName:"ol"},"Terraform \u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"li"},"Provider")," \u5bf9\u8c61\uff0c\u5b8c\u6210\u5bf9\u5e94\u4e91\u670d\u52a1\u5546\u7684\u6743\u9650\u6821\u9a8c\u8fc7\u7a0b\u3002"),(0,o.kt)("li",{parentName:"ol"},"KubeVela \u901a\u8fc7 Terraform \u63a7\u5236\u5668\u6765\u62c9\u8d77\u5bf9\u5e94\u7684\u4e91\u8d44\u6e90\u3002")),(0,o.kt)("h3",{id:"\u5f00\u542f-terraform-\u63a7\u5236\u5668"},"\u5f00\u542f Terraform \u63a7\u5236\u5668"),(0,o.kt)("p",null,"\u63a8\u8350\u4f60\u76f4\u63a5\u901a\u8fc7",(0,o.kt)("a",{parentName:"p",href:"../../end-user/addons/introduction"},"\u7cfb\u7edf\u63d2\u4ef6\uff08addon\uff09"),"\u6765\u5f00\u542f Terraform \u63a7\u5236\u5668\u3002"),(0,o.kt)("h3",{id:"\u914d\u7f6e\u963f\u91cc\u4e91\u9274\u6743"},"\u914d\u7f6e\u963f\u91cc\u4e91\u9274\u6743"),(0,o.kt)("p",null,"\u4ee5\u4e0b\u662f\u963f\u91cc\u4e91\u7684\u9274\u6743\u76f8\u5173\u6b65\u9aa4\uff0c\u5176\u5b83\u4e91\u670d\u52a1\u5546\u540c\u7406\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ export ALICLOUD_ACCESS_KEY=xxx; export ALICLOUD_SECRET_KEY=yyy\nIf you'd like to use Alicloud Security Token Service, also export ALICLOUD_SECURITY_TOKEN.\n\n$ export ALICLOUD_SECURITY_TOKEN=zzz\n$ sh hack/prepare-alibaba-credentials.sh\n\n$ kubectl get secret -n vela-system\nNAME                                              TYPE                                  DATA   AGE\nalibaba-account-creds                             Opaque                                1      11s\n\n$ kubectl apply -f examples/alibaba/provider.yaml\nprovider.terraform.core.oam.dev/default created\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"provider.yaml")," \u8bf7\u4f7f\u7528\u793a\u4f8b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"apiVersion: terraform.core.oam.dev/v1beta1\nkind: Provider\nmetadata:\n  name: default\nspec:\n  provider: alibaba\n  region: cn-beijing\n  credentials:\n    source: Secret\n    secretRef:\n      namespace: vela-system\n      name: alibaba-account-creds\n      key: credentials\n")),(0,o.kt)("h3",{id:"\u4e91\u8d44\u6e90\u5173\u8054-provider"},"\u4e91\u8d44\u6e90\u5173\u8054 Provider"),(0,o.kt)("p",null,"Terraform \u53ef\u4ee5\u7f16\u5199\u3001\u5e94\u7528\u4e00\u4e2a configuration_hcl_oss.yaml \u6765\u914d\u7f6e\u963f\u91cc\u4e91\u7684 OSS \u5b58\u50a8 Bukcet\u3002\u5b83\u4f1a\u53bb\u81ea\u52a8\u5173\u8054 Kubernetes \u96c6\u7fa4\u91cc\u7684\u9ed8\u8ba4 ",(0,o.kt)("inlineCode",{parentName:"p"},"Provider"),"\uff0c\u5373\u4e0a\u4e00\u6b65\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"name: default")," YMAL \u6587\u4ef6\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'apiVersion: terraform.core.oam.dev/v1beta1\nkind: Configuration\nmetadata:\n  name: alibaba-oss\nspec:\n  hcl: |\n    resource "alicloud_oss_bucket" "bucket-acl" {\n      bucket = var.bucket\n      acl = var.acl\n    }\n\n    output "BUCKET_NAME" {\n      value = "${alicloud_oss_bucket.bucket-acl.bucket}.${alicloud_oss_bucket.bucket-acl.extranet_endpoint}"\n    }\n\n    variable "bucket" {\n      description = "OSS bucket name"\n      default = "vela-website"\n      type = string\n    }\n\n    variable "acl" {\n      description = "OSS bucket ACL, supported \'private\', \'public-read\', \'public-read-write\'"\n      default = "private"\n      type = string\n    }\n\n  variable:\n    bucket: "vela-website"\n    acl: "private"\n\n  writeConnectionSecretToRef:\n    name: oss-conn\n    namespace: default\n')),(0,o.kt)("p",null,"\u7136\u540e\u90e8\u7f72\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'$ kubectl apply -f configuration_hcl_oss.yaml\n\n$ kubectl get configuration.terraform.core.oam.dev\nNAME         AGE\nalibaba-oss   1h\n\n$ kubectl get configuration.terraform.core.oam.dev alibaba-oss -o yaml\napiVersion: terraform.core.oam.dev/v1beta1\nkind: Configuration\nmetadata:\n  annotations:\n    kubectl.kubernetes.io/last-applied-configuration: |\n      {"apiVersion":"terraform.core.oam.dev/v1beta1","kind":"Configuration","metadata":{"annotations":{},"name":"alibaba-oss","namespace":"default"},"spec":\n      ...\n       \\"private\\"\\n    }\\n  }\\n}\\n","variable":{"acl":"private","bucket":"vela-website"},"writeConnectionSecretToRef":{"name":"oss-conn","namespace":"default"}}}\n  creationTimestamp: "2021-04-02T08:17:08Z"\n  generation: 2\nspec:\n  ...\n  variable:\n    acl: private\n    bucket: vela-website\n  writeConnectionSecretToRef:\n    name: oss-conn\n    namespace: default\nstatus:\n  outputs:\n    BUCKET_NAME:\n      type: string\n      value: vela-website.oss-cn-beijing.aliyuncs.com\n  state: provisioned\n')),(0,o.kt)("p",null,"\u5229\u7528 ",(0,o.kt)("a",{parentName:"p",href:"https://help.aliyun.com/document_detail/50452.html"},"ossutil")," \u53ef\u4ee5\u770b\u5230 OSS bucket \u5df2\u7ecf\u88ab\u521b\u5efa\u51fa\u6765\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"$ ossutil ls oss://\nCreationTime                                 Region    StorageClass    BucketName\n2021-04-10 00:42:09 +0800 CST        oss-cn-beijing        Standard    oss://vela-website\nBucket Number is: 1\n\n0.146789(s) elapsed\n")),(0,o.kt)("h3",{id:"\u81ea\u5b9a\u4e49-oss-\u4e91\u8d44\u6e90\u7ec4\u4ef6"},"\u81ea\u5b9a\u4e49 OSS \u4e91\u8d44\u6e90\u7ec4\u4ef6"),(0,o.kt)("p",null,"\u5f53\u524d\u9762\u7684\u6b65\u9aa4\u5168\u90e8\u5b8c\u6210\u4e4b\u540e\uff0c\u6700\u540e\u6211\u4eec\u53ea\u9700\u8981\u7ee7\u7eed\u4f7f\u7528\u7ec4\u4ef6\u5b9a\u4e49\uff0c\u5c06\u8fd9\u4e2a ",(0,o.kt)("inlineCode",{parentName:"p"},"alibaba-oss")," \u5f15\u5165\uff0c\u4f5c\u4e3a\u540e\u7eed\u5e94\u7528\u90e8\u7f72\u8ba1\u5212\u7684\u5185\u7f6e\u80fd\u529b\u5373\u53ef\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: core.oam.dev/v1alpha2\nkind: ComponentDefinition\nmetadata:\n  name: alibaba-oss\n  annotations:\n    definition.oam.dev/description: Terraform configuration for Alibaba Cloud OSS object\n    type: terraform\nspec:\n  workload:\n    definition:\n      apiVersion: terraform.core.oam.dev/v1beta1\n      kind: Configuration\n  schematic:\n    terraform:\n      configuration: |\n        resource "alicloud_oss_bucket" "bucket-acl" {\n          bucket = var.bucket\n          acl = var.acl\n        }\n\n        output "BUCKET_NAME" {\n          value = "${alicloud_oss_bucket.bucket-acl.bucket}.${alicloud_oss_bucket.bucket-acl.extranet_endpoint}"\n        }\n\n        variable "bucket" {\n          description = "OSS bucket name"\n          default = "vela-website"\n          type = string\n        }\n\n        variable "acl" {\n          description = "OSS bucket ACL, supported \'private\', \'public-read\', \'public-read-write\'"\n          default = "private"\n          type = string\n        }\n')))}p.isMDXComponent=!0}}]);